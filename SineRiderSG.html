<canvas id="gc" width="1600" height="800"></canvas>

<head>
	<link rel="icon" href="images\TabImage.png">
	<link rel="shortcut icon" href="images\TabImage.png">
	<title>Sine Rider SG</title>
</head>

<!-- 		-----------------------------------------------------------------------		[   Input Test   ]		----------------------------------------------------------------------- -->
<!--<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>-->
<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
<div type="text" id="dinput" placeholder="Last name" value="-x-2" defaultValue="-x" contentEditable="true" style="position:absolute;left:160px;
			top:720px;width:1000px;font-size:50px; font-family:'Arial'; background-color: #FFFFFF; border:1px solid #AAAAAA; overflow: hidden;"></div>
<!-- 		-----------------------------------------------------------------------		[   Input Test   ]		----------------------------------------------------------------------- -->

<!--	Load External Libraries	-->
<!--From   https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.14.2/math.min.js-->
<script src="js/Math.js"></script>

<!--	Load Internal Scripts	-->
<script type="text/javascript" src="js/Collisions.js"></script>
<script type="text/javascript" src="js/Sledder.js"></script>
<script type="text/javascript" src="js/EquationLine.js"></script>
<script type="text/javascript" src="js/LevelSaver.js"></script>
<script type="text/javascript" src="js/LevelLoader.js"></script>
<script type="text/javascript" src="js/XYZView.js"></script>

<script>
	//		Ctrl+Shift+J	shows error log in Chrome
	
	//		time
	var frameTime = 0;//		time since level started (used as t in equations)
	var dt = 0.016666666666666666;//	=1/60	(60 frames per second)
	//var lastTimeRaw = 0;

	//		temporary variables (all of these are used in multiple places. This is to avoid the inefficiency of redeclaring i 10 times a frame)
	var dx = 0;
	var dy = 0;
	var dydt = 0;
	var dxdt = 0;
	var i = 0;
	var ftmp = 0;
	var fftemp = 0;
	var ltmp = 0;
	var rtmp = 0;
	var stmp = "";
	var tmspx;
	var tmspy;
	var tmspz;

	//		should be deleted before launch
	var debugSkipFrame = false;
	var debugSingleFrame = false;

	//		camera position and scale. These coordinates are the position of the upper left corner of the screen.
	var screenWidth = 1600;
	var screenHeight = 800;
	var screenx = 0;
	var screeny = 0;
	var screenScale = 20;
	var trackPointx = 0;//		point the camera will try to keep on screen
	var trackPointy = 0;

	//		gameplay state
	var simulating = false;//		game is running. Sled is moving.
	var paused = false;

	//		canvas
	var canvas;
	var ctx;

	//		for running things differently when a level has just been loaded
	var newLevel = true;

	//		Text colors, [0-9] Partenthasis, [11] x, [12] t, [13] z
	var textColor = ["#00AAFF" , "#660066" , "#33AA33" , "#990033" , "#009999" , "#FF3300" , "#0066AA" , "#FF9900" , "#003399" , "#AAAA00", //		0-9
		"#FF0000" , "#009900" , "#0000FF"];//	10-12
	var parenOpen = 0;

	var timestamp;//		used only for running update()

	window.onload = function(){
		canvas = document.getElementById('gc');
		ctx = canvas.getContext('2d');


		drawXYZ();
		return;

		
		saveLevel();//		for testing
		buildLevelMap();//		for testing
		loadLevelMap();//		for texting
		//ctx.save();
		/*c.addEventListener('mousemove' , function(e){
			mx = e.clientX-6;
			my = e.clientY-6;
		})*/
		setUpSledder();
		window.requestAnimationFrame(update);


		//		-----------------------------------------------------------------------		[   Page Icon   ]		-----------------------------------------------------------------------
		var link = document.querySelector("link[rel*='icon']") || document.createElement('link');
		link.type = 'image/x-icon';
		link.rel = 'shortcut icon';
		link.href = 'SineRiderSGLogo.png';
		document.getElementsByTagName('head')[0].appendChild(link);
	}
	
	document.addEventListener("keydown", function(e) {
		if (e.keyCode == 32){//		shift = 16		//		escape = 27
			//		folowing code from		https://xparkmedia.com/blog/enter-fullscreen-mode-javascript/
			if((document.fullScreenElement && document.fullScreenElement !== null) || (!document.mozFullScreen && !document.webkitIsFullScreen)) {
				//		switch to fullscreen
				screenWidth = window.screen.width * window.devicePixelRatio;
				screenHeight = window.screen.height * window.devicePixelRatio;
				if(document.documentElement.requestFullScreen) {
					document.documentElement.requestFullScreen();
				}else if (document.documentElement.mozRequestFullScreen) {
					document.documentElement.mozRequestFullScreen();
				}else if (document.documentElement.webkitRequestFullScreen) {
					document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
				}
			}else{//		exit fullscreen
				screenWidth = 1600;
				screenHeight = 800;
				if (document.cancelFullScreen) {
					document.cancelFullScreen();
				}else if (document.mozCancelFullScreen) {
					document.mozCancelFullScreen();
				}else if (document.webkitCancelFullScreen) {
					document.webkitCancelFullScreen();
				}
			}
						
			canvas.width = screenWidth;
			canvas.height = screenHeight;
			equInputField.left = Math.round(screenWidth * 0.1);
			equInputField.top = Math.round(screenHeight * 0.9);
			equInputField.width = Math.round(screenWidth * 0.8);
		}
	}, false);

		//		-----------------------------------------------------------------------		[   UPDATE   ]		-----------------------------------------------------------------------
	function update(timestamp){
		window.requestAnimationFrame(update);

		//		-----------------------------------------------------------------------		[   Debugging   ]		-----------------------------------------------------------------------
		//				Debug pause and frame advance//		Hold Ctrl to pause. Press Z to advance single frames
		document.body.onkeyup = function(e){
			if(e.keyCode == 17){//		Ctrl
				debugSkipFrame = false;
			}
		}
		document.body.onkeydown = function(e){
			if(e.keyCode == 17){//		Ctrl
				debugSkipFrame = true;
			}
			if(e.keyCode == 90){//		Z
				debugSingleFrame = true;
			}
		}
		if(debugSkipFrame && !debugSingleFrame)
			return;
		debugSingleFrame = false;
		//				Debug pause and frame advance
		//		-----------------------------------------------------------------------		[   /Debugging   ]		-----------------------------------------------------------------------

		//		on enter down toggle equation editable and simulation running
		//		get keycodes from here: https://css-tricks.com/snippets/javascript/javascript-keycodes/
		document.body.onkeyup = function(e){
			if(e.keyCode == 13){//		enter
				resetSledder();
				$("div").keyup();//		update line. (useful if the player types something while the simulation is running)
			}
		}


		//		canvas
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		drawGrid();
		
		if(simulating){
			frameTime += dt;
		}else{//		-----------------------------------------------------------------------		[   Editing Equation   ]		-----------------------------------------------------------------------
			frameTime = 0;
		}

		drawLine();
		moveSledder();//		see sledder.js

		ctx.fillText( "Scale = " + Math.round(screenScale).toString() , Math.round(screenWidth * 0.8) , Math.round(screenHeight*0.9));
		drawColliders();//		see collisions.js
	}
	//		-----------------------------------------------------------------------		[   /UPDATE/   ]		-----------------------------------------------------------------------

</script>


<div id="slidecontainer">
	<input type="range" min="-3000" max="3000" value="400" class="slider" id="rangeX" width="400">
	<input type="range" min="-3000" max="3000" value="400" class="slider" id="rangeY" width="400">
	<input type="range" min="-3000" max="3000" value="-800" class="slider" id="rangeZ" width="400">

	<input type="range" min="-100" max="100" value="0" class="slider" id="viewY" width="400">

	<input type="range" min="-300" max="300" value="100" class="slider" id="viewRotate" width="400">
</div>

<script>
	document.getElementById("rangeX").oninput = function () {
		camx = Math.round(this.value);
		drawXYZ();
	}
	document.getElementById("rangeY").oninput = function () {
		camy = Math.round(this.value);
		drawXYZ();
	}
	document.getElementById("rangeZ").oninput = function () {
		camz = Math.round(this.value);
		drawXYZ();
	}

	
	document.getElementById("viewY").oninput = function () {
		cForwardy = this.value/100;
		drawXYZ();
	}
	document.getElementById("viewRotate").oninput = function () {
		viewAngle = this.value/100;
		drawXYZ();
	}
</script>
