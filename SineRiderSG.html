<canvas id="gc" width="1600" height="800"></canvas>

<head>
	<link rel="icon" href="TabImage.png">
	<link rel="shortcut icon" href="TabImage.png">
	<title>Sine Rider SG</title>
</head>

<!-- 		-----------------------------------------------------------------------		[   Input Test   ]		----------------------------------------------------------------------- -->
<!--<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>-->
<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
<div type="text" id="dinput" placeholder="Last name" value="-x-2" defaultValue="-x" contentEditable="true" style="position:absolute;left:300px;
			top:700px;width:1000px;font-size:50px; font-family:'Arial'; background-color: #FFFFFF; border:1px solid #AAAAAA; overflow: hidden;"></div>
<!-- 		-----------------------------------------------------------------------		[   Input Test   ]		----------------------------------------------------------------------- -->

<!--	Load External Libraries	-->
<!--From   https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.14.2/math.min.js-->
<script src="js/Math.js"></script>

<!--	Load Internal Scripts	-->
<script type="text/javascript" src="js/Collisions.js"></script>
<script type="text/javascript" src="js/Sledder.js"></script>
<script type="text/javascript" src="js/EquationLine.js"></script>
<script type="text/javascript" src="js/LevelSaver.js"></script>
<script type="text/javascript" src="js/LevelLoader.js"></script>

<script>
	//		Ctrl+Shift+J	shows error log in Chrome
	
	//		time
	var frameTime = 0;//		time since level started (used as t in equations)
	var dt = 0.016666666666666666;//	=1/60	(60 frames per second)
	//var lastTimeRaw = 0;

	//		temporary variables (all of these are used in multiple places. This is to avoid the inefficiency of redeclaring i 10 times a frame)
	var dx = 0;
	var dy = 0;
	var dydt = 0;
	var dxdt = 0;
	var i = 0;
	var ftmp = 0;
	var fftemp = 0;
	var ltmp = 0;
	var rtmp = 0;
	var stmp = "";
	var tmpx;
	var tmpy;

	//		should be deleted before launch
	var debugSkipFrame = false;
	var debugSingleFrame = false;

	//		camera position and scale
	var screenx = 0;
	var screeny = 0;
	var screenScale = 20;

	//		gameplay state
	var simulating = false;//		game is running. Sled is moving.
	var paused = false;

	//		canvas
	var canvas;
	var ctx;

	//		for running things differently when a level has just been loaded
	var newLevel = true;

	//		Text colors, [0-9] Partenthasis, [11] x, [12] t, [13] z
	var textColor = ["#00AAFF" , "#660066" , "#33AA33" , "#990033" , "#009999" , "#FF3300" , "#0066AA" , "#FF9900" , "#003399" , "#AAAA00", //		0-9
		"#FF0000" , "#009900" , "#0000FF"];//	10-12
	var parenOpen = 0;

	var timestamp;//		used only for running update()

	window.onload = function(){
		saveLevel();//		for testing
		buildLevelMap();//		for testing
		loadLevelMap();//		for texting
		canvas = document.getElementById('gc');
		ctx = canvas.getContext('2d');
		loadBuiltInLevel();
		//ctx.save();
		/*c.addEventListener('mousemove' , function(e){
			mx = e.clientX-6;
			my = e.clientY-6;
		})*/
		setUpSledder();
		window.requestAnimationFrame(update);

		//		-----------------------------------------------------------------------		[   Text Input Field   ]		-----------------------------------------------------------------------
		//		https://jsfiddle.net/AbdiasSoftware/VWzTL/
		setUpInput();//		see EquationLine.js
		
		$("#dinput").text("-x-5");
		$("div").keyup();
	}

		//		-----------------------------------------------------------------------		[   UPDATE   ]		-----------------------------------------------------------------------
	function update(timestamp){
		window.requestAnimationFrame(update);

		//				Debug pause and frame advance//		Hold Ctrl to pause. Press Z to advance single frames
		document.body.onkeyup = function(e){
			if(e.keyCode == 17){//		Ctrl
				debugSkipFrame = false;
			}
		}
		document.body.onkeydown = function(e){
			if(e.keyCode == 17){//		Ctrl
				debugSkipFrame = true;
			}
			if(e.keyCode == 90){//		Z
				debugSingleFrame = true;
			}
		}
		if(debugSkipFrame && !debugSingleFrame)
			return;
		debugSingleFrame = false;
		//				Debug pause and frame advance

		//		on enter down toggle equation editable and simulation running
		//		get keycodes from here: https://css-tricks.com/snippets/javascript/javascript-keycodes/
		document.body.onkeyup = function(e){
			if(e.keyCode == 13){//		enter
				resetSledder();
				$("div").keyup();//		update line. (useful if the player types something while the simulation is running)

			}
			
			if(e.keyCode == 27){//		escape
				//		full page canvas
				//canvas.width  = window.innerWidth;
				//canvas.height = window.innerHeight;
				//		full screen
				if(canvas.webkitRequestFullScreen){
					canvas.webkitRequestFullScreen();
				}else{
					canvas.mozRequestFullScreen();
				}  
			}
		}


		//		canvas
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		drawGrid();
		
		if(simulating){
			frameTime += dt;
		}else{//		-----------------------------------------------------------------------		[   Edit Equation   ]		-----------------------------------------------------------------------
			frameTime = 0;
		}


		drawLine();
		moveSledder();//		see sledder.js


		//		-----------------------------------------------------------------------		[   Log to Screen   ]		-----------------------------------------------------------------------
		if(simulating){
			//ctx.fillStyle = "red";//		font color for text overlay
			//var tt = performance.now();

			//ctx.fillText( document.getElementById('eqyTxt').value ,10,50);
		//	ctx.fillText("Speed = " + Math.round(Math.sqrt(vy*vy + vx*vx)).toString(),10,150);
		//	ctx.fillText("vx = " + Math.round(vx).toString() + "  vy = " + Math.round(vy).toString(),10,200);
		}
		//	ctx.fillText( "Scale " + screenScale.toString() + " pixels = 1 meter" ,10,50);
		//	ctx.fillText( "Pos.x = " + Math.round(px+screenx*screenScale).toString() + " py = " + Math.round(py+screeny*screenScale).toString() ,10,300);
			//ctx.fillText( "SCREEN Y = " + screeny.toString() + "SCREEN X = " + screenx.toString() ,10,250);
		drawColliders();//		see collisions.js
	}
	//		-----------------------------------------------------------------------		[   /UPDATE/   ]		-----------------------------------------------------------------------


	function checkKey(e) {
		var event = window.event ? window.event : e;
		move = true;
	}
		
</script>



<div id="slidecontainer">
	Scale:
	<input type="range" min="100" max="6000" value="2000" class="slider" id="myRange">
</div>

<script>
	document.getElementById("myRange").oninput = function() {
		if(simulating){
			px *= this.value/100/screenScale;
			py *= this.value/100/screenScale;
		}else{
			px = defaultPosX*this.value/100 + screenx*screenScale;
			py = defaultPosY*this.value/100 - screeny*screenScale;
		}
		screenScale = this.value/100;

	}
	/*document.getElementById("myRange2").oninput = function() {
		screenx = this.value;
		px += (screenx-lastScreenx)*screenScale;
		lastScreenx = this.value;
	}*/
	/*document.getElementById("myRange2").oninput = function() {
		screeny = this.value;
		py += (screeny-lastScreenx)*screenScale;
		lastScreenx = this.value;
	}*/
</script>